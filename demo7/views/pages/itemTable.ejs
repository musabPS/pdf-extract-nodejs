    <!--begin::Entry-->
    <div class="d-flex flex-column-fluid">
        <!--begin::Container-->
        <div class="container">


            <!--begin::Card-->
            <div class="card card-custom">
                <div class="card-header flex-wrap border-0 pt-6 pb-0">
                    <div class="card-title">
                       Items
                        <h3 class="card-label"> </h3>
                        
                    </div> 

                    <button type="button" class="btn  position-relative" id="button-cart">
                        <i class="flaticon2-shopping-cart-1 text-primary icon-2x"> </i>
                        <span class="position-absolute top-200 start-100 translate-middle badge rounded-pill bg-danger text-white" id="countcart"></span>

                       
                      </button>
            
                    
                </div>
                <div class="card-body ">
                    <!--begin: Search Form-->
                    <!--begin::Search Form-->
                    <form class="mb-6" method="POST" id="tableform">

                        <div class="row align-items-center">
                            <div class="col-lg-9 col-xl-8">
                                <div class="row align-items-center">
                                    <div class="col-md-4 my-2 my-md-0 py-2">
                                        <div class="input-icon">
                                            <input type="text" class="form-control" placeholder="Item" id="search-item" >
                                            <span>
                                                <i class="flaticon2-open-box text-muted"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="col-md-4 my-2 my-md-0 py-2">
                                        <div class="input-icon">
                                            <input type="text" class="form-control" placeholder="Description" id="search-description">
                                            <span>
                                                <i class="flaticon-interface-11 text-muted"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 my-2 my-md-0 py-2">
                                        <div class="input-icon">
                                            <input type="text" class="form-control" placeholder="Model" id="search-model">
                                            <span>
                                                <i class="flaticon-tool text-muted"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="col-md-4 my-2 my-md-0 py-2">
                                        <div class="input-icon">
                                            <input type="text" class="form-control" placeholder="Category" id="search-category">
                                            <span>
                                                <i class="flaticon-layers text-muted"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 my-2 my-md-0 py-2">
                                        <div class="input-icon">
                                            <input type="text" class="form-control" placeholder="Group" id="search-group">
                                            <span>
                                                <i class="flaticon-notes text-muted"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 my-2 my-md-0 py-2">
                                        <div class="input-icon">
                                            <input type="text" class="form-control" placeholder="Brand" id="search-brand">
                                            <span>
                                                <i class="flaticon2-tag text-muted"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 my-2 my-md-0 py-2">
                                        <div class="input-icon">
                                            <input type="text" class="form-control" placeholder="Type" id="search-type">
                                            <span>
                                                <i class="flaticon-suitcase text-muted"></i>
                                            </span>
                                        </div>
                                    </div>


                                </div>
                            </div>
                            <div class="col-lg-3 col-xl-4 mt-5 mt-lg-0">
                                <button type="button" class="btn btn-light-primary" id="searchitems">Search</button>
                                <button type="button" class="btn btn-light-danger">Reset</button>
                            </div>
                        </div>
                   
                </form>




                    <!--end::Search Form-->
                    <!--end: Search Form-->
                    <!--begin: Datatable-->


                    <div class="content d-flex flex-column flex-column-fluid " id="kt_content">
						<!--begin::Entry-->
						<div class="d-flex flex-column-fluid">
							<!--begin::Container-->
							<div class="container">
							
							
								<!--begin::Row-->
								<div class="row" id="itemscard">


                                    <%  var i=0; itemData.forEach((el)=>{ i++ %>
                                        <div class="col-xs-4 col-xl-4 mb-2 py-4">
                                            <!--begin::Iconbox-->
                                            <div class="card card-custom wave wave-primary mb-8 mb-lg-0">
                                                <div class="card-body ">
                                                    <div class="mr-8">
                                                        <img src="https://gaido.com.my/wp-content/uploads/2014/09/bearing_x-thumb3-1.png" style="height: 10rem; width:100%">
                                                    </div>
                                                    <div class="separator separator-solid separator-dark opacity-10 py-md-2"></div>
    
                                                    <div class="d-flex align-items-center p-5">
                                                        
                                                        <div class="d-flex flex-column">
                                                            <a href="/itemFrom&internalid=1" class="text-dark text-hover-primary font-weight-bold font-size-h4 mb-3"><%=el.name%></a>
                                                            <div class="text-dark-75">D: F/w BRG</div>
                                                            <div class="text-dark-75">B: NSK</div>
                                                            <div class="text-dark-75">Q: 2.00</div>
                                                          
                                                            <div class="separator separator-primary opacity-10 py-md-2"></div>
                                                            <div class="input-group ">
    
                                                                <div class="input-group-prepend qtyicon bg-light-secondary">
                                                                    <button  class="bg-light-secondary btn   inventorydetail text-left" data-toggle="modal" data-target="#inventorydetailmodel"><i class="fas fa-boxes  text-primary text-align-left"></i></button>

                                                                    <span class="input-group-text bg-light-secondary">
                                                                        <i class="flaticon2-shopping-cart bg-light-secondary"></i>
                                                                    </span>
                                                                </div>
                                                                <input type="number" class="form-control " id="<%= i %>" internalid="<%=el.internalId%>" rate="<%=el.basePrice%>" placeholder="0" value="" min="0" disabled>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--end::Iconbox-->
                                            
                                        </div>
                                        <%}) %> 

             
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Container-->
						</div>
						<!--end::Entry-->
					</div>

                    <!--end: Datatable-->
                </div>
            </div>
            <!--end::Card-->
        </div>
        <!--end::Container-->

        <!-- Modal -->
<div class="modal fade" id="inventorydetailmodel" role="dialog">
    <div class="modal-dialog">
    
    <!-- Modal content-->
    <div class="modal-content">
    <div class="modal-header">
    <h5 class="modal-title">Inventory Detail</h5>
    </br>
    
    
    </div>
    <div class="modal-body">
    
        <h5 class="modal-title" style="padding-bottom: 2px;">Item Name : <span id="modalspan_itemname" style="font-size: 5;"></span></h5>
       
        <div class="separator separator-solid separator-primary opacity-20" ></div>
    
            <table class="table modeltable"  id="" >
            <thead>
            <tr>
            
                <th scope="col">Location</th>
                <th scope="col">Quantity</th>
            </tr>
            </thead>
            <tbody class="modeltable-body">
            
            </tbody>
    
            </table>
    
    </div>
    
    <div class="modal-footer">
       
    </div>
    
    </div>
    
    </div>
    </div>

    <!-- END  Modal -->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <script>
            var totalItems='<%- itemDataLength%>'
            var selectItems=[]
            var item=[]
            var countQty=0




//

// var Nodata ="<tr><th colspan='10' style='font-weight:normal;'>No Data Available In Table</th></tr>"
// $('#table-main tbody').append(Nodata);


$(function () {

            $(".qtyicon").click(function(e)
            {
               
                var id=$(this).next().attr("id")
                var itemInternalId=$(this).next().attr("internalid")

                console.log("itemInternalId",itemInternalId)

               var inputClass = $(this).find("span i").attr("class")

               if(inputClass.indexOf("text-primary") >= 0)
               {
                 $(this).find("span i").attr("class","flaticon2-shopping-cart")
                 $(this).next().prop( "disabled", true );

                 if(! $('#'+id).val())
                 {
                    const index = item.indexOf(id);
                    if (index > -1) {
                        item.splice(index, 1);
                    }

                    console.log("itemid",item)
                 }
                 else
                 {
                   lastValue = $('#countcart').text()-parseInt($('#'+id).val())
                    $('#countcart').text(lastValue)
                    const index = item.indexOf(id);
                    if (index > -1) {
                        item.splice(index, 1);
                    }

                 }
                 
               }

               if(inputClass.indexOf("text-primary") < 0)
               {
                 $(this).find("span i").attr("class","flaticon2-shopping-cart text-primary")
                 $(this).next().prop( "disabled", false );
               
                 if(! $('#'+id).val())
                 {
                    item.push(id)
                      console.log("itemidfirst",item)
                 }
                 else
                 {
                   lastValue = parseInt($('#countcart').text())+parseInt($('#'+id).val())
                 
                    $('#countcart').text(lastValue)

                     item.push(id)
                      console.log("itemidfirst",item)

                  
                 }
                 
               }

                 $(this).next().change(function()
                 {
                  for(var i=1; i <=totalItems; i++)
                  {
                      if(!parseInt($('#'+i).val()))
                      {
                          continue
                      }
                      else
                      {
                        countQty+=parseInt($('#'+i).val())

                      }
                  }
                  $('#countcart').text(countQty)
                  countQty=0
                  });
                
                 // $(selectClass).removeClass('');

                 // var selectClass=$(this).find("span i").attr("class")
                 // 
                 //cart
                  // $("#container li.name input.name_val").val();
           
             });

        });



             $("#button-cart").click(function(){
                     // alert("");
                     console.log("finalItem",item)
                     var items=[]
                       for(var i=0; i <item.length; i++)
                       {
                         let element = document.getElementById(item[i]); 
                         let itemInternalId = element.getAttribute("internalid"); 
                         let itemRate = element.getAttribute("rate"); 
                         console.log("itemInternalIdss",itemInternalId)
                         items.push({
                             'itemInternalId'       : itemInternalId,
                             'itemQuantity'         : element.value,
                             'itemId'               : item[i],
                             'itemRate'             : itemRate

                            })
                          
                        console.log("finalIteminloop",items)
                       }

                       console.log("finalItem",items)
                       localStorage.setItem("itemDetail", JSON.stringify(items));

                       location.replace("/create-sales-order?&c=1")
                      
            });

            $("#searchitems").click(function(e)
            {
                var itemCard=''

                var postForm = { //Fetch form data
                'name'         :  $('#search-item').val(),
               // 'description'  :  $('#search-description').val(),
                // 'model'        :  $('#search-model').val(),
                // 'category'     :  $('#search-category').val(),
                // 'group'        :  $('#search-group').val(),
                // 'brand'        :  $('#search-brand').val(),
                // 'type'         :  $('#search-type').val(),
                        };

                $.ajax({
                        type      : 'POST', //Method type
                        url       : '/search_items', //Your form processing file URL
                        data      : JSON.stringify(postForm), //Forms name
                        contentType: "application/json; charset=utf-8",
                        success   : function(data) 
                                    {
                                        console.log(data)

                                        $('#itemscard').empty();
                                        totalItems=data.length
                                        for(var i=0; i<data.length; i++)
                                        {
                                            console.log(data[i])
                                            itemCard+=' <div class="col-xs-4 col-xl-4 mb-2 py-4">'
                                            
                                            +'<div class="card card-custom wave wave-primary mb-8 mb-lg-0">'
                                              +'<div class="card-body ">'
                                                    +'<div class="mr-8">'
                                                        +'<img src="https://gaido.com.my/wp-content/uploads/2014/09/bearing_x-thumb3-1.png" style="height: 10rem; width:100%">'
                                                        +'</div>'
                                                        +'<div class="separator separator-solid separator-dark opacity-10 py-md-2"></div>'
    
                                                        + '<div class="d-flex align-items-center p-5">'
                                                        
                                                            + '<div class="d-flex flex-column">'
                                                                + '<a href="/itemFrom&internalid=1" class="text-dark text-hover-primary font-weight-bold font-size-h4 mb-3">'+data[i].name+'</a>'
                                                                + '<div class="text-dark-75">D: F/w BRG</div>'
                                                                + '<div class="text-dark-75">B: NSK</div>'
                                                                +'<div class="text-dark-75">Q: 2.00</div>'
                                                                
                                                                + '<div class="separator separator-primary opacity-10 py-md-2"></div>'
                                                                + '<div class="input-group ">'
    
                                                                    +  '<div class="input-group-prepend qtyicon bg-light-secondary">'
                                                                        +  '<button  class="bg-light-secondary btn   inventorydetail text-left" data-toggle="modal" data-target="#inventorydetailmodel"><i class="fas fa-boxes  text-primary text-align-left"></i></button>'

                                                                        + '<span class="input-group-text bg-light-secondary">'
                                                                            +  '<i class="flaticon2-shopping-cart bg-light-secondary"></i>'
                                                                            +  '</span>'
                                                                            + '</div>'
                                                                            +  '<input type="number" class="form-control " id="'+i+'" internalid="'+data[i].internalId+'" rate="'+data[i].basePrice+'" placeholder="0" value=""  min="0" disabled>'
                                                                            +  '</div>'
                                                                            + '</div>'
                                                                            +  '</div>'
                                                                            +  '</div>'
                                                                            + '</div>'
                                           
                                                                     + '</div>'

                                        }

                                        console.log(itemCard)

                                        $('#itemscard').html(itemCard);


                                    }           
                    });
            });

            
        </script>

<script type="text/javascript">
    function tableToCSV() {
        //alert("clicked");
            // Variable to store the final csv data
            var csv_data = [];
 
            // Get each row data
            var rows = document.getElementsByTagName('tr');
            console.log("rows",rows)
            for (var i = 0; i < rows.length; i++) {
 
                // Get each column data
                var cols = rows[i].querySelectorAll('td,th');
                console.log("cols",cols)
                // Stores each csv row data
                var csvrow = [];
                for (var j = 0; j < cols.length-1; j++) {
 
                    // Get the text data of each cell
                    // of a row and push it to csvrow
                    csvrow.push(cols[j].innerText);
                }
 
                // Combine each column value with comma
                csv_data.push(csvrow.join(","));
            }
 
            // Combine each row data with new line character
            csv_data = csv_data.join('\n');
 
            // Call this function to download csv file 
            downloadCSVFile(csv_data);
    }

     function downloadCSVFile(csv_data) {
 
            // Create CSV file object and feed
            // our csv_data into it
            CSVFile = new Blob([csv_data], {
                type: "text/csv"
            });
 
            // Create to temporary link to initiate
            // download process
            var temp_link = document.createElement('a');
 
            // Download csv file
            temp_link.download = "exportcsv.csv";
            var url = window.URL.createObjectURL(CSVFile);
            temp_link.href = url;
 
            // This link should not be displayed
            temp_link.style.display = "none";
            document.body.appendChild(temp_link);
 
            // Automatically click the link to
            // trigger download
            temp_link.click();
            document.body.removeChild(temp_link);
        }


       


</script>